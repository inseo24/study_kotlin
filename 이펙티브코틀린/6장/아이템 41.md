# 아이템 41 : hashCode의 규약을 지켜라

hashCode 함수는 수많은 컬렉션과 알고리즘에 사용되는 자료 구조인 해시 테이블(hash table)을 구축할 때 사용합니다. 

### 해시테이블

컬렉션에 요소를 빠르게 추가하고, 컬렉션에서 요소를 빠르게 추출해야 한다고 합시다. 이럴 때 사용할 수 있는 컬렉션으로는 세트와 맵이 있습니다. 이 둘은 중복을 허용하지 않습니다. 따라서 요소를 추가할 때, 일단 동일한 요소가 이미 들어있는지 확인해야 합니다.

배열 또는 링크드 리스트를 기반으로 만들어진 컬렉션은 요소가 포함되어 있는지 확인하는 성능이 좋지 않습니다. 요소가 포함되어 있는지 확인할 때 하나하나 모든 요소를 비교해야 하기 때문입니다. 수백 만 개의 텍스트가 포함된 배열에 특정 텍스트가 포함되어 있는지 확인해야 한다고 합시다. 수백 만 개의 텍스트를 선형으로 비교한다면 꽤 오랜 시간이 걸릴 것입니다.

성능을 좋게 만드는 해결 방법이 바로 해시 테이블입니다. 각 요소에 숫자를 할당하는 함수가 필요한데, 이 함수를 해시 함수라고 부르고 같은 요소라면 항상 같은 숫자를 리턴합니다.

추가적으로 해시 함수가 다음과 같은 특성을 가지고 있으면 좋습니다. 

- 빠르다
- 충돌이 적다(다른 값이라면 최대한 다른 숫자를 리턴한다)

해시 함수는 각 요소에 특정 숫자를 할당하고, 이를 기반으로 다른 bucket에 넣습니다. 또한 해시 함수의 기본적인 조건에 의해서, 같은 요소는 항상 동일한 버킷에 넣게 됩니다. 버킷은 버킷 수와 같은 크기의 배열인 해시 테이블에 보관합니다. 요소를 추가하는 경우에는 해시 함수로 배치할 버킷을 계산하고, 이 버킷 안에 요소를 추가합니다. 

해시 함수의 속도는 빨라야 하므로 이 처리는 매우 빠르게 이뤄집니다. 요소를 찾는 경우에도 해시 함수로 만들어지는 숫자를 활용해 버킷을 찾은 뒤, 버킷 내부에서 원하는 요소를 찾습니다. 

해시 함수는 같은 요소라면 같은 값을 리턴하므로, 다른 버킷을 확인할 필요 없이 바로 원하는 것이 들어 있는 버킷을 찾을 수 있습니다. 예를 들어, 1,000,000개의 요소와 1,000개의 버컷이 있는 경우 버킷을 특정한 후에 해당 버킷 내부에 원하는 요소가 있는지 찾으면 됩니다. 버킷 하나에 평균 1,000개의 요소가 들어 있을 것이므로 1,000번만 비교하면 됩니다. 

### hashCode의 규약

명확한 규약이 있습니다. 코틀린 1.3.11을 기준으로 공식적인 규약을 정리해보면, 다음과 같습니다.

- 어떤 객체를 변경하지 않았다면, hashCode를 여러 번 호출해도 그 결과가 항상 같아야 합니다.
- equals 메서드의 실행 결과로 두 객체가 같다고 나온다면, hashCode 메서드의 호출 결과도 같다고 나와야 합니다.

필수 요구 사항은 아니지만 제대로 사용하려면 지켜야 하는 요구 사항이 있습니다. 바로 hashCode는 최대한 요소를 넓게 퍼뜨려야 한다는 것입니다. 다른 요소라면 최대한 다른 해시 값을 갖는 것이 좋습니다.