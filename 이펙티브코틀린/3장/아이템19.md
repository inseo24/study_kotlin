# 아이템 19 : knowledge를 반복해 사용하지 말라

실용주의 프로그래머에서, DRY 원칙에 대해 ‘모든 지식은 시스템 내에서 단일하고, 애매하지 않고, 정말로 믿을 만한 표현 양식을 가져야 한다'라고 설명합니다. 여기서 ‘knowledge’는 우리가 일반적으로 표현하는 지식과 약간 다르게 의도적인 정보를 나타내는 개념입니다. 

DRY(Don’t Repeat Yourself)는 SSOT(Single Source of Truth)라는 이름으로도 알려져있습니다. 

 

### knowledge

의도적인 정보로 코드나 데이터로 표현할 수 있습니다. 기본 동작을 하게 아예 코드와 데이터를 부족하게 만들어서도 표현할 수 있습니다. 상속을 하는데도 불구하고 특정 메서드를 오버라이드하지 않게 강제한다는 것은 ‘해당 메서드가 슈퍼클래스와 동일하게 동작하기 원한다'는 의미입니다.

이처럼 프로젝트를 진행할 때 정의한 모든 것이 knowledge 입니다.

알고리즘의 작동 방식, UI의 형태, 우리가 원하는 결과 등이 모두 ‘의도적인 정보'이며 knowledge 입니다. 

중요한 두 가지 knowledge를 뽑으면 아래와 같습니다.

1. logic : 프로그램이 어떤 식으로 동작하는지와 프로그램이 어떻게 보이는지
2. 공통 알고리즘(common algorithm): 원하는 동작을 하기 위한 알고리즘

둘의 큰 차이점은 시간에 따른 변화입니다. 비즈니스 로직은 시간에 따라 바뀌나 공통 알고리즘은 한 번 정의된 이후로 크게 변경되지 않습니다. 물론 공통 알고리즘을 최적화하거나, 같은 카테고리의 더 빠른 알고리즘으로 바꿀 수 있지만, 동작은 크게 변하지 않습니다. 따라서 이후에 다루는 내용에서는 공통 알고리즘 부분을 더 자세히 살펴볼 것입니다. 

### 모든 것은 변화한다

변화하는 이유는 아래와 같습니다.

- 회사가 사용자의 요구 또는 습관을 더 많이 알게 되었다.
- 디자인 표준이 변화했다.
- 플랫폼, 라이브러리, 도구 등이 변화해서 이에 대응해야 한다.

대부분의 프로젝트는 몇 달마다 요구 사항과 내부적인 구조를 계속해서 변경합니다. 이는 바람직한 일입니다. 

널리 사용되는 많은 관리 시스템은 애자일하며, 요구 사항의 변화를 맞추는 데 적합합니다.

예를 들어, 슬랙은 글리치라는 온라인 게임이었으나 소비자들이 이 게임의 커뮤니케이션 방식을 굉장히 좋아했고 현재의 슬랙으로 변화한 것입니다. 

모든 것은 변하고, 변화할 때 가장 큰 적은 knowledge가 반복된다는 점입니다. 

이는 확장성(scalable)을 막고, 쉽게 깨지게(fragile) 만듭니다. 다행히 개발자는 반복을 줄일 수 있는 도구와 기능들을 활용할 수 있습니다. SQL을 작성하지 않고 하이버네이트 같은 ORM, Exposed 같은 DAO(Data Access Object)를 활용할 수 있습니다. 

### 언제 코드를 반복해도 될까?

반복을 줄이면 안되는 상황은 어떨 때일까요?

함께 변경될 가능성이 높은지? 따로 변경될 가능성이 높은지?를 고민해봐야 합니다. 코드를 추출하는 이유도 결국 변경을 쉽게 만들기 위함입니다. 

한 가지 유용한 휴리스틱으로, 비즈니스 규칙이 다른 곳에서 왔는지 확인하는 방법이 있습니다. 

다른 곳에서 왔다면, 독립적으로 변경될 가능성이 높습니다. 잘못된 코드 추출로부터 우리를 보호할 수 있는 규칙도 있습니다. 바로 단일 책임 원칙(Single Responsibility Principle) 입니다.

### 단일 책임 원칙

클래스를 변경하는 이유는 단 한 가지여야 한다.

두 액터가 같은 클래스를 변경하는 일은 없어야 한다. 

여기서 액터는 변화를 만들어 내는 존재를 의미하고, 서로의 업무와 분야에 대해 잘 모르는 개발자들로 비유됩니다. 이런 개발자들이 같은 코드를 변경하는 것은 굉장히 위험한 일입니다. 

단일 책임 원칙은 우리에게 두 가지 사실을 알려 줍니다.

1. 서로 다른 곳에서 사용하는 knowledge는 독립적으로 변경할 가능성이 많습니다. 따라서 비슷한 처리를 하더라도, 원전히 다른 knowledge로 취급하는 것이 좋습니다.
2. 다른 knowledge는 분리해 두는 것이 좋습니다. 그렇지 않으면, 재사용해서는 안되는 부분을 재사용하려는 유혹이 발생할 수 있습니다.